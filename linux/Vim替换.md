# `Vim`的正则表达式

转自博客[http://qianjigui.javaeye.com/blog/368449](http://qianjigui.javaeye.com/blog/368449),删除了一些不常用的东西,同时添加了<<学习vi和vim编辑器>>的部分内容.



毋庸多言，在`vim`中正则表达式得到了十分广泛的应用。 最常用的` /` 和 `:s` 命令中，正则表达式都是不可或缺的。 下面对`vim`中的正则表达式的一些难点进行说明。

# 关于`magic`

`vim`中有个`magic`的设定。设定方法为：

```shell
:set magic " 设置magic 
:set nomagic " 取消magic 
:h magic " 查看帮助
```

`vim`毕竟是个编辑器，正则表达式中包含的大量元字符如果原封不动地引用（像`perl` 那样）， 势必会给不懂正则表达式的人造成麻烦，比如 `/foo(1)` 命令， 大多数人都用它来查找`foo(1)`这个字符串， 但如果按照正则表达式来解释，被查找的对象就成了 `foo1` 了。

于是，`vim`就规定，正则表达式的元字符必须用反斜杠进行转义才行， 如上面的例子，如果确实要用正则表达式，就应当写成` /foo\(1\)` 。 但是，像` . *` 这种极其常用的元字符，都加上反斜杠就太麻烦了。 而且，众口难调，有些人喜欢用正则表达式，有些人不喜欢用……

为了解决这个问题，`vim`设置了 `magic` 这个东西。简单地说， `magic`就是设置哪些元字符要加反斜杠哪些不用加的。 简单来说：

> **magic**  (\m)：除了` $ . * ^` 之外其他元字符都要加反斜杠。
> **nomagic** (\M)：除了 `$ ^` 之外其他元字符都要加反斜杠。

这个设置也可以在正则表达式中通过 `\m \M` 开关临时切换。 `\m` 后面的正则表达式会按照 `magic` 处理，`\M` 后面的正则表达式按照 `nomagic` 处理， 而忽略实际的`magic`设置。

例如：

```shell
/\m.* # 查找任意字符串 
/\M.* # 查找字符串 .* （点号后面跟个星号）
```

另外还有更强大的 `\v` 和 `\V`。

`\v` （即 `very magic` 之意）：任何元字符都不用加反斜杠`\V` （即 `very nomagic` 之意）：任何元字符都必须加反斜杠

例如：

```shell
/\v(a.c){3}$ # 查找行尾的abcaccadc 
/\m(a.c){3}$ # 查找行尾的(abc){3} 
/\M(a.c){3}$ # 查找行尾的(a.c){3} 
/\V(a.c){3}$ # 查找任意位置的(a.c){3}$
```

默认设置是 `magic`，`vim`也推荐大家都使用`magic`的设置，在有特殊需要时，直接通过` \v\m\M\V` 即可。

#量词
本文下面使用的元字符都是 `magic `模式下的。

| vim          | 意义                                       |
| ------------ | ---------------------------------------- |
| `*`          | 匹配` 0`个或多个(匹配优先)                         |
| `\+`         | 匹配`1`个或多个(匹配优先)                          |
| ` \? `或` \=` | `0`个或`1`个(匹配优先)，`\?`不能在 `?` 命令（逆向查找）中使用  |
| ` \{n,m}`    | 匹配`n`个到`m`个(匹配优先),如`\d{1, 3}`可以匹配`1`到`3`个数字,类似`11`, `1`, `333` |
| `\{n,}`      | 最少`n`个(匹配优先)                             |
| `\{,m}`      | 最多`m`个(匹配优先)                             |
| `\{n}`       | 恰好`n`个                                   |
在这里,有些东西需要说明一下,那就是上面的用于限定数量的元字符不单单可以用于字符,同时也可以用于模式,举个例子,下面的模式:
```shell
\(123\)\{2}
```
可以匹配`123123`.
# 一些常用的元字符

| 元字符        | 说明                                       |
| ---------- | ---------------------------------------- |
| `.`        | 匹配任意一个字符,如`p*p`可以匹配字符串`pep`, `pip`或者`pcp` |
| `[abc]`    | 匹配方括号中的任意一个字符。可以使用-表示字符范围                |
| `[a-z0-9]` | 匹配小写字母和阿拉伯数字                             |
| `[^abc]`   | 在方括号内开头使用`^`符号，表示匹配除方括号中字符之外的任意字符        |
| `\d`       | 匹配阿拉伯数字，等同于`[0-9]`                       |
| `\D`       | 匹配阿拉伯数字之外的任意字符，等同于`[^0-9]`               |
| `\x`       | 匹配十六进制数字，等同于`[0-9A-Fa-f]`                |
| `\w`       | 匹配单词字母，等同于`[0-9A-Za-z_]`                 |
| `\W`       | 匹配单词字母之外的任意字符，等同于`[^0-9A-Za-z_]`         |
| `\t`       | 匹配`<TAB>`字符                              |
| `\s`       | 匹配空白字符，等同于`[ \t]`                        |
| `\S`       | 匹配非空白字符，等同于`[^ \t]`                      |
| `\a`       | 所有的字母字符. 等同于`[a-zA-Z]`                   |
| `\l`       | 小写字母` [a-z]`                             |
| `\L`       | 非小写字母` [^a-z]`                           |
| `\u`       | 大写字母 `[A-Z]`                             |
| `\U`       | 非大写字幕`[^A-Z]`                            |

## 元字符的转义:

`\*` 匹配 `*` 字符
`\.` 匹配 `.` 字符
`\/` 匹配 `/` 字符
`\\` 匹配` \` 字符
`\[` 匹配 `[` 字符

## 表示位置的符号

| 位置元字符     | 含义                                       |
| --------- | ---------------------------------------- |
| `$`       | 匹配行尾,如`here:$`只会匹配出位于一行结尾的`here:`.       |
| `^`       | 匹配行首,如`^Part`只会匹配出位于一行开头的`Part`.         |
| `\<` `\>` | 会匹配出以某些字符开头的(`\<`)或结尾(`\>`)的单词.`\<ac`只会匹配出以`ac`开头的单词,如`action`,而`ac>/`只会匹配出以`ac`结尾的单词,如`maniac`.`\<action\>`会匹配出`action`这个单词.单词的开头和结尾,是用标点符号或空格来分隔的. |



## 替换变量

在正规表达式中使用 `\(` 和 `\)` 符号括起正规表达式，即可在后面使用`\1`、`\2`等变量来访问 `\(` 和 `\)` 中的内容。这种形式实际上是将`\(`与`\)`中的模式保存到了特殊的空间(称之为"保留缓冲区").这种方法可以保存任意一行中的`9`个模式.

举个例子,对于下面的模式:

```shell
\(That\) or \(this\)
```

会将`That`存放到缓冲区`1`中,而将`this`保存到保留缓冲区`2`中,这些保留的模式在以后可以用`\1`到`\9`的序列重新排列,例如,如果要将`That or this`改成`this or That`,可以键入:

```shell
:%s/\(That\) or \(this\)/\2 or \1/
```

也可以实现在搜索或者替换字符串时使用\n表示法:

```shell
:%s\(abcd\)\1/alphabet-soup/
```

可以将`abcdabcd`替换为`alphabet-soup`.



# 常用的替换命令

删除所有的空白行

```shell
:g/^$/d
```









